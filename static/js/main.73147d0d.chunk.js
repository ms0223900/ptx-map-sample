(this["webpackJsonpptx-map-sample"]=this["webpackJsonpptx-map-sample"]||[]).push([[0],{57:function(t,e,n){t.exports=n(69)},63:function(t,e,n){},69:function(t,e,n){"use strict";n.r(e);var a=n(0),r=n.n(a),o=n(15),i=n.n(o),c=n(23),u=n(32),s=[22.631411,120.301915],m=3e3,l=5e3,f=7e3,p=3e3,h=1e4,S=function(t){var e=Object(a.useState)({zoom:14,center:t.position}),n=Object(u.a)(e,2),r=n[0],o=n[1],i=Object(a.useCallback)((function(t){t.center&&o(Object(c.a)({},t,{center:t.center}))}),[]);return Object(a.useEffect)((function(){o({zoom:t.zoom,center:t.position})}),[JSON.stringify(t)]),{mapViewPort:r,handleSetMapViewPort:i}},g=n(18),d=n.n(g),v=n(29),b=n(14),k=n(24),E=function(){function t(){Object(b.a)(this,t)}return Object(k.a)(t,null,[{key:"getPositionFromStationPosition",value:function(t){return[t.PositionLat,t.PositionLon]}},{key:"getLocationLocaleName",value:function(t){return function(){return t.Zh_tw}}},{key:"makeEqFilterStr",value:function(t){return"StationID eq '".concat(t,"'")}},{key:"joinStationIDsFilterStr",value:function(e){return e.map((function(e){return t.makeEqFilterStr(e)})).join(" or ")}},{key:"getAPIWithStationIDsFilter",value:function(t,e){var n=this.joinStationIDsFilterStr(e);return"".concat(t).concat(n)}},{key:"getRadiusFromMapZoom",value:function(t){return!t||t<13?h:15===t?m:14===t?l:13===t?f:p}}]),t}(),w=function(t){var e=t.lat,n=t.lon,a=t.radius;return"https://ptx.transportdata.tw/MOTC/v2/Rail/Metro/Station/KRTC?&$format=JSON&$spatialFilter=nearby(StationPosition,".concat(e,",").concat(n,",").concat(a,")")},O=n(51),j=function(){var t=(new Date).toUTCString(),e=new O.a("SHA-1","TEXT");return e.setHMACKey("FwK7JpE73iJSY0N8KWD_ftUm_pk","TEXT"),e.update("x-date: "+t),{Authorization:'hmac username="f57caa871b2e4db9ad6402c2c6e77a0d", algorithm="hmac-sha1", headers="x-date", signature="'+e.getHMAC("B64")+'"',"X-Date":t}};function D(){return(D=Object(v.a)(d.a.mark((function t(e){var n,a,r,o;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.uri,a=e.defaultRes,r=e.requestInit,o=a,t.next=4,fetch(n,Object(c.a)({},r)).then((function(t){return t.json()})).then((function(t){o=t})).catch((function(t){return console.log(t)}));case 4:return t.abrupt("return",o);case 5:case"end":return t.stop()}}),t)})))).apply(this,arguments)}var M=function(t){return D.apply(this,arguments)},y=function(){function t(){Object(b.a)(this,t)}return Object(k.a)(t,null,[{key:"makeSingleMrtMarkerData",value:function(t){return{position:t.position,mrtStationName:t.mrtStationName,locationEstimateTimeListData:t.locationEstimateTimeListData}}},{key:"makeSingleLocationEstimateTime",value:function(t){return function(){return{name:E.getLocationLocaleName(t.DestinationStationName)(),estimateTime:t.EstimateTime}}}},{key:"getSingleStationLocationEstimateTimes",value:function(t,e){var n=this;return function(){return e.filter((function(e){return e.StationID===t})).map((function(t){return n.makeSingleLocationEstimateTime(t)()}))}}},{key:"makeMrtMarkerListDataFromRaw",value:function(e,n){return function(){return e.map((function(e){var a=t.getSingleStationLocationEstimateTimes(e.StationID,n)(),r=E.getPositionFromStationPosition(e.StationPosition),o=E.getLocationLocaleName(e.StationName)();return t.makeSingleMrtMarkerData({position:r,mrtStationName:o,locationEstimateTimeListData:a})}))}}}]),t}(),P=function(){var t=Object(v.a)(d.a.mark((function t(e){var n,a,r,o,i,c,u;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n=[],a=j(),r=w(e),t.next=5,M({uri:r,requestInit:{headers:a},defaultRes:[],useCorsPrefix:!1});case 5:if(o=t.sent,!((i=o.map((function(t){return t.StationID}))).length>0)){t.next=14;break}return c=E.getAPIWithStationIDsFilter("https://ptx.transportdata.tw/MOTC/v2/Rail/Metro/LiveBoard/KRTC?&$format=JSON&$filter=",i),t.next=11,M({uri:c,requestInit:{headers:a},defaultRes:[],useCorsPrefix:!1});case 11:u=t.sent,n=y.makeMrtMarkerListDataFromRaw(o,u)(),console.log(o,u);case 14:return t.abrupt("return",n);case 15:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}();var F=function(t){var e=t.position,n=t.zoom,r=E.getRadiusFromMapZoom(n),o=function(t){var e=t.apiPath,n=t.initResponseData,r=t.fetchFn,o=Object(a.useState)(!1),i=Object(u.a)(o,2),c=i[0],s=i[1],m=Object(a.useState)(),l=Object(u.a)(m,2),f=l[0],p=l[1],h=Object(a.useState)(n),S=Object(u.a)(h,2),g=S[0],d=S[1];return{loading:c,error:f,handleFetchData:Object(a.useCallback)((function(){s(!0),(r?r():M({uri:e,defaultRes:n})).then((function(t){return d(t)})).catch((function(t){console.error(t),p(t)})).finally((function(){s(!1)}))}),[e,r,n]),responseData:g}}({apiPath:"",initResponseData:[],fetchFn:Object(a.useCallback)(Object(v.a)(d.a.mark((function t(){var n,a;return d.a.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return n={lat:e[0],lon:e[1],radius:r},t.next=3,P(n);case 3:return a=t.sent,t.abrupt("return",a);case 5:case"end":return t.stop()}}),t)}))),[e,r])});return Object(c.a)({},o,{mrtStations:o.responseData,handleFetchMrtStations:o.handleFetchData})},L=function(){var t=S({position:s,zoom:14}),e=t.mapViewPort,n=t.handleSetMapViewPort,a=e.center,r=e.zoom,o=F({position:a,zoom:r});return Object(c.a)({mapViewPort:e,handleSetMapViewPort:n},o)},T=n(43),x=n(44),C=n(80),z=n(83),I=(n(63),Object(C.a)((function(t){return{root:{width:"100%",height:600}}}))),N=function(t){var e=t.children,n=I();return r.a.createElement(z.a,Object.assign({className:n.root},t),r.a.createElement(T.a,Object.assign({style:{height:"100%"},zoom:14,center:t.position},t),r.a.createElement(x.a,{opacity:.9,url:"https://wmts.nlsc.gov.tw/wmts/EMAP/default/GoogleMapsCompatible/{z}/{y}/{x}"}),e))},R=n(50),V=n.n(R),A=n(84),J=function(t){var e=t.onSearchMrtStations;return r.a.createElement(A.a,{variant:"contained",onClick:e},r.a.createElement("img",{src:"./asset/images/icons/icon-directions_subway-24px.svg",alt:"mrt-icon"}))},q=function(t){return r.a.createElement(V.a,{position:"bottomright"},r.a.createElement(J,t))},K=n(3),W=n.n(K),$=n(45),B=n(46),_=n(81),H=n(82),U=function(t){var e=t.mrtStationName,n=t.locationEstimateTimeListData;return r.a.createElement(z.a,null,r.a.createElement(_.a,{variant:"h6"},e),r.a.createElement(H.a,null),n.map((function(t,e){return r.a.createElement(r.a.Fragment,null,r.a.createElement(_.a,{key:e},"\u5f80".concat(t.name,"\uff1a\u7d04").concat(t.estimateTime,"\u5206")))})))},X=function(t){var e=W.a.icon({iconUrl:"./asset/images/icons/icon-marker.svg",iconSize:[24,34]});return r.a.createElement($.a,{icon:e,position:t.position},r.a.createElement(B.a,{autoPan:!1},r.a.createElement(U,t)))},Z=function(t){return r.a.createElement(r.a.Fragment,null,t.markerListData.map((function(t,e){return r.a.createElement(X,Object.assign({key:e},t))})))},G=function(t){var e=t.zoom,n=t.position,a=t.markerListData,o=t.onSearchMrtStations,i=t.onViewportChanged;return r.a.createElement(N,{position:n,zoom:e,onViewportChanged:i},r.a.createElement(Z,{markerListData:a}),r.a.createElement(q,{onSearchMrtStations:o}))},Y=function(){var t=L(),e=(t.loading,t.mrtStations),n=t.mapViewPort,a=t.handleFetchMrtStations,o=t.handleSetMapViewPort;return r.a.createElement(G,{position:n.center,zoom:n.zoom,markerListData:e,onSearchMrtStations:a,onViewportChanged:o})};var Q=function(){return r.a.createElement(r.a.Fragment,null,r.a.createElement(Y,null))};Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));i.a.render(r.a.createElement(r.a.StrictMode,null,r.a.createElement(Q,null)),document.getElementById("root")),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then((function(t){t.unregister()})).catch((function(t){console.error(t.message)}))}},[[57,1,2]]]);
//# sourceMappingURL=main.73147d0d.chunk.js.map